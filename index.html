<!DOCTYPE html>
<html>
<head>
    <title>Invent√°rio BACEN</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial; padding: 20px; max-width: 600px; margin: auto; }
        input, button { padding: 10px; margin: 5px; width: 100%; box-sizing: border-box; }
        .login { background: #f0f0f0; padding: 20px; border-radius: 5px; }
        .form { display: none; background: #e8f4ff; padding: 20px; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <div class="login" id="loginSection">
        <h2>üîí Login Invent√°rio BACEN</h2>
        <input type="password" id="tokenInput" placeholder="Cole seu token de acesso">
        <button onclick="login()">Acessar Sistema</button>
        <p class="error" id="loginError"></p>
    </div>

    <div class="form" id="appSection">
        <h2>‚ûï Adicionar Computador</h2>
        <input id="hostname" placeholder="Hostname (ex: PC-001)">
        <input id="sistema" placeholder="Sistema Operacional">
        <input id="memoria" placeholder="Mem√≥ria (GB)" type="number">
        <input id="processador" placeholder="Processador">
        <button onclick="adicionarComputador()">Cadastrar</button>
        
        <h2>üìã Computadores Cadastrados</h2>
        <button onclick="carregarComputadores()">Atualizar Lista</button>
        <div id="lista"></div>
    </div>
    <!-- ========== NOVO: MENU DE NAVEGA√á√ÉO ========== -->
<div style="margin: 20px 0; padding: 10px; background: #f0f0f0; border-radius: 5px;">
    <button onclick="mostrarAtivos()" style="margin-right: 10px;">
        üñ•Ô∏è Computadores Ativos
    </button>
    <button onclick="mostrarHistorico()" style="margin-right: 10px;">
        üìú Hist√≥rico Completo
    </button>
    <button onclick="mostrarTodos()">
        üîÑ Todos os Registros
    </button>
</div>

<!-- ========== NOVA √ÅREA DE CONTE√öDO ========== -->
<div id="conteudo">
    <!-- Aqui vai aparecer ativos, hist√≥rico ou todos -->
</div>

<script>
// ========== FUN√á√ïES NOVAS ==========

function mostrarAtivos() {
    fetch(`${API_URL}/api/ativos`, {
        headers: { 'Authorization': `Bearer ${token}` }
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('conteudo').innerHTML = criarTabela(data.ativos, 'Computadores Ativos');
        document.getElementById('lista').innerHTML = ''; // Limpa a lista antiga
    })
    .catch(error => alert('Erro: ' + error));
}

function mostrarHistorico() {
    fetch(`${API_URL}/api/historico`, {
        headers: { 'Authorization': `Bearer ${token}` }
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('conteudo').innerHTML = criarTabela(data.historico, 'Hist√≥rico Completo');
        document.getElementById('lista').innerHTML = '';
    })
    .catch(error => alert('Erro: ' + error));
}

function mostrarTodos() {
    // Usa a rota original
    carregarComputadores();
    document.getElementById('conteudo').innerHTML = '';
}

function criarTabela(dados, titulo) {
    if (!dados || dados.length === 0) {
        return `<h3>${titulo}</h3><p>Nenhum registro encontrado.</p>`;
    }
    
    let html = `
        <h3>${titulo} (${dados.length} registros)</h3>
        <table border="1" style="width:100%; border-collapse:collapse;">
        <thead>
            <tr style="background:#ddd">
                <th>Hostname</th>
                <th>Sistema</th>
                <th>Mem√≥ria</th>
                <th>Processador</th>
                <th>√öltima Atualiza√ß√£o</th>
            </tr>
        </thead>
        <tbody>`;
    
    dados.forEach(item => {
        html += `
            <tr>
                <td><strong>${item.hostname}</strong></td>
                <td>${item.sistema_operacional}</td>
                <td>${item.memoria_gb ? item.memoria_gb + ' GB' : 'N/A'}</td>
                <td>${item.processador || 'N/A'}</td>
                <td>${new Date(item.ultima_coleta).toLocaleString()}</td>
            </tr>`;
    });
    
    html += `</tbody></table>`;
    return html;
}

// Modifica a fun√ß√£o existente para tamb√©m usar a tabela
function mostrarComputadores(computadores) {
    const lista = document.getElementById('lista');
    if (!computadores || computadores.length === 0) {
        lista.innerHTML = '<p>Nenhum computador cadastrado.</p>';
        return;
    }
    
    lista.innerHTML = criarTabela(computadores, 'Todos os Computadores');
}
</script>

    <script>
        let token = '';
        const API_URL = 'https://inventario-api-production-a70e.up.railway.app';

        function login() {
            token = document.getElementById('tokenInput').value.trim();
            if (!token) {
                document.getElementById('loginError').textContent = 'Digite o token!';
                return;
            }
            
            // Testa se token funciona
            fetch(`${API_URL}/api/computadores`, {
                headers: { 'Authorization': `Bearer ${token}` }
            })
            .then(response => {
                if (response.ok) {
                    document.getElementById('loginSection').style.display = 'none';
                    document.getElementById('appSection').style.display = 'block';
                    carregarComputadores();
                } else {
                    document.getElementById('loginError').textContent = 'Token inv√°lido!';
                }
            })
            .catch(() => {
                document.getElementById('loginError').textContent = 'Erro de conex√£o!';
            });
        }

        async function carregarComputadores() {
            try {
                const response = await fetch(`${API_URL}/api/computadores`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                mostrarComputadores(data.computadores);
            } catch (error) {
                alert('Erro ao carregar: ' + error);
            }
        }

        async function adicionarComputador() {
            const computador = {
                hostname: document.getElementById('hostname').value,
                sistema_operacional: document.getElementById('sistema').value,
                memoria_gb: document.getElementById('memoria').value ? parseFloat(document.getElementById('memoria').value) : null,
                processador: document.getElementById('processador').value || null
            };

            try {
                const response = await fetch(`${API_URL}/api/inventario`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(computador)
                });
                const data = await response.json();
                alert(data.mensagem);
                if (data.status === 'sucesso') {
                    carregarComputadores();
                    // Limpa formul√°rio
                    document.getElementById('hostname').value = '';
                    document.getElementById('sistema').value = '';
                    document.getElementById('memoria').value = '';
                    document.getElementById('processador').value = '';
                }
            } catch (error) {
                alert('Erro ao cadastrar: ' + error);
            }
        }

        function mostrarComputadores(computadores) {
            const lista = document.getElementById('lista');
            if (!computadores || computadores.length === 0) {
                lista.innerHTML = '<p>Nenhum computador cadastrado.</p>';
                return;
            }
            
            lista.innerHTML = computadores.map(comp => `
                <div style="border:1px solid #ccc; padding:10px; margin:10px 0;">
                    <strong>${comp.hostname}</strong><br>
                    SO: ${comp.sistema_operacional}<br>
                    ${comp.memoria_gb ? 'Mem√≥ria: ' + comp.memoria_gb + ' GB<br>' : ''}
                    ${comp.processador ? 'Processador: ' + comp.processador + '<br>' : ''}
                    √öltima atualiza√ß√£o: ${new Date(comp.ultima_coleta).toLocaleString()}
                </div>
            `).join('');
        }
    </script>
</body>
</html>
